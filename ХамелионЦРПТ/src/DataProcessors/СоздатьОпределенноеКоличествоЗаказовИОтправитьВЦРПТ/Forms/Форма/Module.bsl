Функция ПолучитьИзПользователя()
	Возврат обработки._Запуск_ХамелеонЦРПТ.ПолучитьИзПользователя(Объект.ТекущийПользователь);
Конецфункции
	

&НаКлиенте
Функция МассивЗаказовДляПолучения()

	МассивЗаказов=Новый Массив;
	Thumbprint_1=ПолучитьИзПользователя();
			ПараметрыДлякилента=Thumbprint_1;
				АдресРаздробить=ПараметрыДлякилента.АдресСУЗ;
				Адрес=Сред(АдресРаздробить,Найти(АдресРаздробить,"://")+3);
				Адрес=Сред(Адрес,1,Найти(Адрес,":")-1);
				Порт=Сред(АдресРаздробить,Найти(АдресРаздробить,"://")+3);
				Порт=Сред(Порт,Найти(Порт,":")+1);
				Попытка
					Порт=число(Порт);
				Исключение
					Порт=Неопределено;
				КонецПопытки;
				
		Если Не ЗначениеЗаполнено(Адрес) Тогда
			
			ПоказатьПредупреждение(,"В пользователе не заполнен адрес СУЗ");
			Возврат МассивЗаказов;
			
		КонецЕсли;
		
			Если Найти(АдресРаздробить,"https")=1 Тогда
				Защищ=Новый ЗащищенноеСоединениеopenSSL();
			Иначе
				Защищ=Неопределено;
			КонецЕсли;
		
			Срегистра="";
			СерийныйНомер="";
	  	Куки=ОбщиеМетоды_НаКлиенте_ХамелеонЦРПТ.ПолучитькукиВСУЗ(Thumbprint_1,,Срегистра,СерийныйНомер);
			
		Если Не ЗначениеЗаполнено(Куки) 
			ИЛИ Не ЗначениеЗаполнено(Срегистра) ИЛИ Не ЗначениеЗаполнено(СерийныйНомер) 
			Тогда
			
		//	ОбщийМодуль_НаСервере_ХамелеонЦРПТ.ЗаписатьТокенВРегистр(Thumbprint_1.Thumbprint_1,"");
		//	Если УжеОтправили<>Истина Тогда
		//		 ПолучитьТокенИИД(Команда,Истина)
		//	КонецЕсли;
			Возврат МассивЗаказов;
			
		КонецЕсли;




		Если Ложь Тогда
		//		Если НЕ ЗагрузканаСервереПолучитьКМИзФЗШ_Шины(ПараметрыДлякилента,Адрес,Порт,Защищ) Тогда
		//					ПоказатьПредупреждение(,"Не удалось подключиться к СУЗ");
		//	
		//		КонецЕсли;
				
				
			Иначе
				
					Если ЗначениеЗАполнено(ПараметрыДлякилента.АдресПрокси) Тогда
						Прокси=Новый ИнтернетПрокси;
						Прокси.Установить("http",ПараметрыДлякилента.АдресПрокси,ПараметрыДлякилента.ПортПрокси,ПараметрыДлякилента.ПользовательПрокси,ПараметрыДлякилента.ПарольПрокси);
					
						HTTPСервисЗапрос=Новый HTTPСоединение(Адрес,Порт,,,Прокси,,Защищ);
					Иначе
						HTTPСервисЗапрос=Новый HTTPСоединение(Адрес,Порт,,,,,Защищ);
					КонецЕсли;
					
											//Если ОБъект.СУЗОбувь Тогда
											
											
											
//								HTTPЗапрос = Новый HTTPЗапрос("api/v2/"+ПараметрыДлякилента.СайтКСУЗ+"/codes?orderId="+Объект._Order_ID+"&gtin="+ПолучитьGTIN(Стр.GTIN)+"&quantity="+
//								Формат(Получить,"ЧГ=")+"&lastBlockId="+Строка(Стр.ПоследнийБлок)+"&omsId="+ПараметрыДлякилента.ИдентификаторСУЗ);
							//Иначе
							//	HTTPЗапрос = Новый HTTPЗапрос("api/v2/"+ПараметрыДлякилента.СайтКСУЗ+"/codes?orderId="+Стр.ИДСУЗ+"&gtin="+ПолучитьGTIN(Стр.GTIN)+"&quantity="+
							//	Формат(Получить,"ЧГ=")+"&lastBlockId="+Строка(Стр.ПоследнийБлок)+"&omsId="+ПараметрыДлякилента.ИдентификаторСУЗ);
								
							//КонецЕслИ;
							
							
							
							
							
							
							//ИдентификаторСУЗ=ОбщиеМетоды_НаКлиенте_ХамелеонЦРПТ.ПодключениеКСУЗ_ХамелеонЦРПТ(ПараметрыДлякилента);
							 // HTTPЗапрос = Новый HTTPЗапрос("api/v2/"+ПараметрыДлякилxента.СайтКСУЗ+"/orders?omsId="+ПараметрыДлякилента.ИдентификаторСУЗ);
							 
							 СайтКСУЗ=Врег(ПараметрыДлякилента.СайтКСУЗ);
							 Если    СайтКСУЗ="LP" Тогда
								 СайтКСУЗ="LIGHT"
							Конецесли;
							 
							 HTTPЗапрос = Новый HTTPЗапрос("webapi/v1/orders?limit=100&skip=0&productGroup="+СайтКСУЗ);
							 

							 
							 
							 ТокенСУЗ=ОбщиеМетоды_НаКлиенте_ХамелеонЦРПТ.ПодключениеКСУЗ_ХамелеонЦРПТ(ПараметрыДлякилента);
							
								HTTPЗапрос.Заголовки.Вставить("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");
								HTTPЗапрос.Заголовки.Вставить("clientToken",ТокенСУЗ);
								HTTPЗапрос.Заголовки.Вставить("Cookie",Куки);
								
								Попытка
									Ответ=HTTPСервисЗапрос.Получить(HTTPЗапрос);
								Исключение
									Возврат МассивЗаказов;
								КонецПопытки;
								ТекстДокумента=Ответ.ПолучитьТелоКакСтроку();
								
								NNNN=ОбщийМодуль_НаСервере_ХамелеонЦРПТ.ЗаполнитьСтруктуруИзОтветаJSON(ТекстДокумента);
								
								orderSummaryInfos="";
								Если NNNN.Свойство("orderSummaryInfos",orderSummaryInfos) Тогда
									Для Каждого Стр Из orderSummaryInfos  Цикл
										HTTPЗапрос = Новый HTTPЗапрос("webapi/v1/orders/"+Стр.orderid); //"static/1555676332000/js/main/preload.js");
										HTTPЗапрос.Заголовки.Вставить("Content-Type","application/json;charset=UTF-8");
										HTTPЗапрос.Заголовки.Вставить("Cookie",Куки);
										
											
										Ответ=HTTPСервисЗапрос.Получить(HTTPЗапрос);
										Текст1=Ответ.ПолучитьТелоКакСтроку();
										
										NNN_1=ОбщийМодуль_НаСервере_ХамелеонЦРПТ.ЗаполнитьСтруктуруИзОтветаJSON(СтрЗАменить(Текст1,"@class","class"));
										
										
										HTTPЗапрос = Новый HTTPЗапрос("webapi/v1/orders/"+Стр.orderid+"/buffer"); //"static/1555676332000/js/main/preload.js");
										HTTPЗапрос.Заголовки.Вставить("Content-Type","application/json;charset=UTF-8");
										HTTPЗапрос.Заголовки.Вставить("Cookie",Куки);
										
											
										Ответ=HTTPСервисЗапрос.Получить(HTTPЗапрос);
										Текст1=Ответ.ПолучитьТелоКакСтроку();
										
										NNN_2=ОбщийМодуль_НаСервере_ХамелеонЦРПТ.ЗаполнитьСтруктуруИзОтветаJSON(СтрЗАменить(Текст1,"@class","class"));
										
										
										ДД=ОбщийМодуль_НаСервере_ХамелеонЦРПТ.СоздатьДокументНасервере(NNN_2,NNN_1);
										Если ЗначениеЗаполнено(ДД) Тогда
											МассивЗаказов.Добавить(ДД);
										Конецесли;

									//	Возврат;
										
								Конеццикла;
							Конецесли;
									
								
								
			КонецЕсли;		
	
			Возврат МассивЗаказов
			//ыКонецЕсли;	
КонецФункции


Функция СоздатьЗаказы_1(Сколько,Сч_1)
	
	МассивЗаказов=Новый Массив;
	Для Сч=1 По Сколько Цикл
		Сч_1=Сч_1+1;
		СоздатьЗаказ=Документы.ЗаказМарок_ХамелеонЦРПТ.СоздатьДокумент();
		СоздатьЗаказ.Дата=Текущаядата();
		СоздатьЗаказ.ТекущийПользователь=Объект.ТекущийПользователь;
		если СоздатьЗаказ.ТекущийПользователь.ТипВводаВОборот=Перечисления.ТипыДокументаВводВОборот_ХамелеонЦРПТ.МаркировкаОстатков Тогда
			СоздатьЗаказ.СпособВыпускаТоваров=Перечисления.СпособВыпускаТоваров_ХамелеонЦРПТ.МаркировкаОстатков;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.ТипВводаВОборот=Перечисления.ТипыДокументаВводВОборот_ХамелеонЦРПТ.ВводВОборотИмпорт 
			ИЛИ СоздатьЗаказ.ТекущийПользователь.ТипВводаВОборот=Перечисления.ТипыДокументаВводВОборот_ХамелеонЦРПТ.ИмпортСФТС
			Тогда
			СоздатьЗаказ.СпособВыпускаТоваров=Перечисления.СпособВыпускаТоваров_ХамелеонЦРПТ.ВвезенВРФ;
		Иначе
			СоздатьЗаказ.СпособВыпускаТоваров=Перечисления.СпособВыпускаТоваров_ХамелеонЦРПТ.ПроизведенВРФ
		КонецЕсли;
		
		СоздатьЗаказ.Организация=СоздатьЗаказ.ТекущийПользователь.Организация;
		СоздатьЗаказ.ШаблонКМ=СоздатьЗаказ.ТекущийПользователь.ШаблонКМПоУмолчанию;
		СоздатьЗаказ.ШаблонКМ_Табак=СоздатьЗаказ.ТекущийПользователь.ШаблонКМТабакПоУмолчанию;
		СоздатьЗаказ.ТипОплаты=СоздатьЗаказ.ТекущийПользователь.ТипОплаты;
		Если Не ЗначениеЗаполнено(СоздатьЗаказ.ШаблонЭтикетки) Тогда
			СоздатьЗаказ.ШаблонЭтикетки=СоздатьЗаказ.ТекущийПользователь.ШаблонЭтикетки;
		КонецЕсли;
		Если Не ЗначениеЗАполнено(СоздатьЗаказ.НомерДоговораСОператором) ТОгда
			СоздатьЗаказ.НомерДоговораСОператором=СоздатьЗаказ.ТекущийПользователь.НомерДоговораСОператором;
		КонецЕсли;
		Если Не ЗначениеЗаполнено(СоздатьЗаказ.ДатаДоговораСОператором) Тогда
			СоздатьЗаказ.ДатаДоговораСОператором=СоздатьЗаказ.ТекущийПользователь.ДатаДоговораСОператором;
		КонецЕсли;
		Если не ЗначениеЗаполнено(СоздатьЗаказ.ШаблонЭтикетки) тогда
			СоздатьЗаказ.ШаблонЭтикетки=СоздатьЗаказ.ТекущийПользователь.ШаблонЭтикетки;
		КонецЕсли;
		Для Каждого Стр Из СоздатьЗаказ.Товары Цикл
			Если Не ЗначениеЗаполнено(Стр.СпособФормированияСН) Тогда
				Стр.СпособФормированияСН=СоздатьЗаказ.ТекущийПользователь.СпособФормированияСН;
				
			КонецЕслИ;
			Если Не ЗначениеЗаполнено(Стр.ВидСИ) Тогда
				Стр.ВидСИ=СоздатьЗаказ.ТекущийПользователь.ВидСИ;
				
			КонецЕслИ;
			Если Не ЗначениеЗаполнено(Стр.ВидМаркировки) Тогда
				Стр.ВидМаркировки=СоздатьЗаказ.ТекущийПользователь.ВидМаркировки;
			КонецЕслИ;
		Конеццикла;
		Если СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Шины" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Шины;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Молоко" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Молоко;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Одежда" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Одежда;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Табак" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Табак;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Альтернативный табак" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.АльтернативныйТабак;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Фармацевтика" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Фармацевтика;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Фото" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Фото;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Парфюм" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Парфюм;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Велосипеды" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Велосипеды;
			
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Питьевая вода" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.ПитьеваяВода;
			
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Кресла-коляски" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.КреслаКоляски;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Пиво" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Пиво;
			
		Иначе
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Обувь
		КонецЕсли;
		
		Для Каждого Стр_1 Из Объект.ТабличнаяЧастьЗаказов Цикл
			Добав=СоздатьЗаказ.Товары.Добавить();
			Добав.GTIN=Стр_1.Продукция;
			Добав.КоличествоКМ=Стр_1.КоличествоКМ;
			
			Добав.ВидМаркировки=Перечисления.ВидМаркировки_ХамелеонЦРПТ.НаТовар;
			Добав.ТипКодаМаркировки=Перечисления.ТипКодаМаркировки_ХамелеонЦРПТ.UNIT;
			Добав.СпособФормированияСН=Перечисления.СпособФормированияСН_ХамелеонЦРПТ.ОператорИСМП;
		Конеццикла;
		
		СоздатьЗаказ.Записать();
		МассивЗаказов.Добавить(СоздатьЗаказ.Ссылка);
	Конеццикла;
	
	Возврат МассивЗаказов
	
КонецФункции


&НаКлиенте
Процедура СоздатьИОтправить(Команда)
	сч=0;
	
	Пока Сч<=Объект.КоличествоЗаказов Цикл
	
	
		/////1. Получаем с СУЗ все заказы
		МассивЗаказовДляПолучения=МассивЗаказовДляПолучения();
		/////2. Делаем приемку этих закзаов
		Для Каждого Стр_1 Из МассивЗаказовДляПолучения Цикл
			Форм=ПолучитьФорму("Документ.ЗаказМарок_ХамелеонЦРПТ.Форма.ФормаДокумента",Новый Структура(
			"Ключ",Стр_1));
			Форм.ПолучитьКМИзAPI(Команда);
		Конеццикла;
		МассивЗаказовДляПолучения=МассивЗаказовДляПолучения();
		Если МассивЗаказовДляПолучения.Количество()<10 Тогда
			МассивДляОтправки=СоздатьЗаказы_1(10-МассивЗаказовДляПолучения.Количество(),Сч);
			Для Каждого Стр_11 Из МассивДляОтправки Цикл
				Форм=ПолучитьФорму("Документ.ЗаказМарок_ХамелеонЦРПТ.Форма.ФормаДокумента",
				Новый Структура("Ключ",Стр_11));
				Форм.ОтправитьВЦРПТ(Команда);
			Конеццикла;
		Конецесли;
		
	Конеццикла;
	
	
	Возврат;
	
	// Вставить содержимое обработчика.
	Если Не ЗначениеЗаполнено(Объект.КоличествоЗаказов) 
		ИЛИ Объект.ТабличнаяЧастьЗаказов.Количество()=0
		ИЛИ Не ЗначениеЗаполнено(Объект.ТекущийПользователь) Тогда
		Возврат;
	Конецесли;
	
	Счечт=0;
	Пока Счечт<=Объект.КоличествоЗаказов Цикл
		
		МассивДляОтправки=СоздатьЗаказы();
		
		Для Каждого Стр_11 Из МассивДляОтправки Цикл
			Форм=ПолучитьФорму("Документ.ЗаказМарок_ХамелеонЦРПТ.Форма.ФормаДокумента",
			Новый Структура("Ключ",Стр_11));
			Форм.ОтправитьВЦРПТ(Команда);
		Конеццикла;
	Конеццикла;
КонецПроцедуры


Функция СоздатьЗаказы()
	
	МассивЗаказов=Новый Массив;
	Для Сч=1 По Объект.КоличествоЗаказов Цикл
		СоздатьЗаказ=Документы.ЗаказМарок_ХамелеонЦРПТ.СоздатьДокумент();
		СоздатьЗаказ.Дата=Текущаядата();
		СоздатьЗаказ.ТекущийПользователь=Объект.ТекущийПользователь;
		если СоздатьЗаказ.ТекущийПользователь.ТипВводаВОборот=Перечисления.ТипыДокументаВводВОборот_ХамелеонЦРПТ.МаркировкаОстатков Тогда
			СоздатьЗаказ.СпособВыпускаТоваров=Перечисления.СпособВыпускаТоваров_ХамелеонЦРПТ.МаркировкаОстатков;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.ТипВводаВОборот=Перечисления.ТипыДокументаВводВОборот_ХамелеонЦРПТ.ВводВОборотИмпорт 
			ИЛИ СоздатьЗаказ.ТекущийПользователь.ТипВводаВОборот=Перечисления.ТипыДокументаВводВОборот_ХамелеонЦРПТ.ИмпортСФТС
			Тогда
			СоздатьЗаказ.СпособВыпускаТоваров=Перечисления.СпособВыпускаТоваров_ХамелеонЦРПТ.ВвезенВРФ;
		Иначе
			СоздатьЗаказ.СпособВыпускаТоваров=Перечисления.СпособВыпускаТоваров_ХамелеонЦРПТ.ПроизведенВРФ
		КонецЕсли;
		
		СоздатьЗаказ.Организация=СоздатьЗаказ.ТекущийПользователь.Организация;
		СоздатьЗаказ.ШаблонКМ=СоздатьЗаказ.ТекущийПользователь.ШаблонКМПоУмолчанию;
		СоздатьЗаказ.ШаблонКМ_Табак=СоздатьЗаказ.ТекущийПользователь.ШаблонКМТабакПоУмолчанию;
		СоздатьЗаказ.ТипОплаты=СоздатьЗаказ.ТекущийПользователь.ТипОплаты;
		Если Не ЗначениеЗаполнено(СоздатьЗаказ.ШаблонЭтикетки) Тогда
			СоздатьЗаказ.ШаблонЭтикетки=СоздатьЗаказ.ТекущийПользователь.ШаблонЭтикетки;
		КонецЕсли;
		Если Не ЗначениеЗАполнено(СоздатьЗаказ.НомерДоговораСОператором) ТОгда
			СоздатьЗаказ.НомерДоговораСОператором=СоздатьЗаказ.ТекущийПользователь.НомерДоговораСОператором;
		КонецЕсли;
		Если Не ЗначениеЗаполнено(СоздатьЗаказ.ДатаДоговораСОператором) Тогда
			СоздатьЗаказ.ДатаДоговораСОператором=СоздатьЗаказ.ТекущийПользователь.ДатаДоговораСОператором;
		КонецЕсли;
		Если не ЗначениеЗаполнено(СоздатьЗаказ.ШаблонЭтикетки) тогда
			СоздатьЗаказ.ШаблонЭтикетки=СоздатьЗаказ.ТекущийПользователь.ШаблонЭтикетки;
		КонецЕсли;
		Для Каждого Стр Из СоздатьЗаказ.Товары Цикл
			Если Не ЗначениеЗаполнено(Стр.СпособФормированияСН) Тогда
				Стр.СпособФормированияСН=СоздатьЗаказ.ТекущийПользователь.СпособФормированияСН;
				
			КонецЕслИ;
			Если Не ЗначениеЗаполнено(Стр.ВидСИ) Тогда
				Стр.ВидСИ=СоздатьЗаказ.ТекущийПользователь.ВидСИ;
				
			КонецЕслИ;
			Если Не ЗначениеЗаполнено(Стр.ВидМаркировки) Тогда
				Стр.ВидМаркировки=СоздатьЗаказ.ТекущийПользователь.ВидМаркировки;
			КонецЕслИ;
		Конеццикла;
		Если СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Шины" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Шины;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Молоко" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Молоко;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Одежда" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Одежда;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Табак" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Табак;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Альтернативный табак" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.АльтернативныйТабак;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Фармацевтика" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Фармацевтика;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Фото" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Фото;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Парфюм" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Парфюм;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Велосипеды" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Велосипеды;
			
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Питьевая вода" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.ПитьеваяВода;
			
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Кресла-коляски" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.КреслаКоляски;
		ИначеЕсли СоздатьЗаказ.ТекущийПользователь.СайтыВходаВСистему.Наименование="Пиво" Тогда
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Пиво;
			
		Иначе
			СоздатьЗаказ.ТипПродукции=Перечисления.ТипПродукции_ХамелеонЦРПТ.Обувь
		КонецЕсли;
		
		Для Каждого Стр_1 Из Объект.ТабличнаяЧастьЗаказов Цикл
			Добав=СоздатьЗаказ.Товары.Добавить();
			Добав.GTIN=Стр_1.Продукция;
			Добав.КоличествоКМ=Стр_1.КоличествоКМ;
			
			Добав.ВидМаркировки=Перечисления.ВидМаркировки_ХамелеонЦРПТ.НаТовар;
			Добав.ТипКодаМаркировки=Перечисления.ТипКодаМаркировки_ХамелеонЦРПТ.UNIT;
			Добав.СпособФормированияСН=Перечисления.СпособФормированияСН_ХамелеонЦРПТ.ОператорИСМП;
		Конеццикла;
		
		СоздатьЗаказ.Записать();
		МассивЗаказов.Добавить(СоздатьЗаказ.Ссылка);
	Конеццикла;
	
	Возврат МассивЗаказов
	
КонецФункции


&НаКлиенте
Процедура ДополучитьКМ(Команда)
	
	Пока Истина Цикл
		МассивЗаказовДляПолучения=МассивЗаказовДляПолучения();
		Если МассивЗаказовДляПолучения.Количество()=0 Тогда
			Возврат;
		Конецесли;
		
		/////2. Делаем приемку этих закзаов
		Для Каждого Стр_1 Из МассивЗаказовДляПолучения Цикл
			Форм=ПолучитьФорму("Документ.ЗаказМарок_ХамелеонЦРПТ.Форма.ФормаДокумента",Новый Структура(
			"Ключ",Стр_1));
			Форм.ПолучитьКМИзAPI(Команда);
		Конеццикла;
	КонецЦикла;
	
КонецПроцедуры


&НаКлиенте
Процедура ПриОткрытии(Отказ)
	// Вставить содержимое обработчика.
	Форм=ПолучитьФорму("Обработка._Запуск_ХамелеонЦРПТ.Форма.Форма");
	Открыта=Ложь;
	
	Если НЕ Форм.Открыта() ТОгда
		Форм.Открыть();
		Открыта=Истина;
	Конецесли;
	
	ТекущийПользователь=Форм.Пользователь;
	Если Открыта=Истина Тогда
		Форм.Закрыть();
		
	Конецесли;
	
КонецПроцедуры

