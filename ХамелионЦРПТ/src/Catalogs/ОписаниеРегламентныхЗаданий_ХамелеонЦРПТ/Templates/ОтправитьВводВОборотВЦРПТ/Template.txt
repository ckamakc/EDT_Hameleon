	// Вставить содержимое обработчика.
		//{{КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ВводВОборот_ХамелеонЦРПТ.Ссылка КАК Ссылка,
		|	ВводВОборот_ХамелеонЦРПТ.ТекущийПользователь КАК ТекущийПользователь
		|ИЗ
		|	Документ.ВводВОборот_ХамелеонЦРПТ КАК ВводВОборот_ХамелеонЦРПТ
		|ГДЕ
		|	ВводВОборот_ХамелеонЦРПТ.Дата МЕЖДУ &НачДата И &КонДата
		|	И НЕ ВводВОборот_ХамелеонЦРПТ.ПометкаУдаления
		|	И (ВводВОборот_ХамелеонЦРПТ.Статус = &Статус1
		|			ИЛИ ВводВОборот_ХамелеонЦРПТ.Статус = &Статус2)
		|ИТОГИ ПО
		|	ТекущийПользователь,
		|	Ссылка";
	
	Запрос.УстановитьПараметр("КонДата", КонецДня(Текущаядата()));
	Запрос.УстановитьПараметр("НачДата", НачалоДня(Текущаядата()));
	Запрос.УстановитьПараметр("Статус1", Перечисления.СтатусыДокументов_ХамелеонЦРПТ.ПодготовленКОтправке);
	Запрос.УстановитьПараметр("Статус2", Перечисления.СтатусыДокументов_ХамелеонЦРПТ.ПустаяСсылка());
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи_1 = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	
	Пока ВыборкаДетальныеЗаписи_1.Следующий() Цикл
		
			ПользовательДляОтправки=ВыборкаДетальныеЗаписи_1.ТекущийПользователь;
			Thumbprint_1=Обработки._Запуск_ХамелеонЦРПТ.ПолучитьИзПользователя(ПользовательДляОтправки);
			
			
			СтруктураНастроек=Неопределено;                                                    СерийныйНомер="";
		СРегистра=ОбщийМодуль_НаСервере_ХамелеонЦРПТ.ПолучитьТокенСрегистра(Thumbprint_1.Thumbprint_1,СтруктураНастроек);
		Если Не ЗначениеЗаполнено(СРегистра) тогда
			СРегистра=ОбщийМодуль_НаСервере_ХамелеонЦРПТ.Получение_Токена(Thumbprint_1,СерийныйНомер);	
		Иначе
		   
				Если ЗначениеЗАполнено(Thumbprint_1.АдресПрокси) Тогда
					Прокси=Новый ИнтернетПрокси;
					Прокси.Установить("http",Thumbprint_1.АдресПрокси,Thumbprint_1.ПортПрокси,Thumbprint_1.ПользовательПрокси,Thumbprint_1.ПарольПрокси);
				
					HTTPСервисЗапрос=Новый HTTPСоединение(Thumbprint_1.АдресДляПолученияТокена,,,,Прокси,Thumbprint_1.Таймаут,Новый ЗащищенноеСоединениеopenSSL());
				Иначе
				
					HTTPСервисЗапрос=Новый HTTPСоединение(Thumbprint_1.АдресДляПолученияТокена,,,,,Thumbprint_1.Таймаут,Новый ЗащищенноеСоединениеopenSSL());
				КонецЕсли;
				
				HTTPЗапрос=Новый HTTPЗапрос("api/v3/facade/balance/all");
				HTTPЗапрос.Заголовки.Вставить("Content-Type","application/json;charset=UTF-8");
				HTTPЗапрос.Заголовки.Вставить("Authorization","Bearer "+СРегистра);
				//HTTPЗапрос.Заголовки.Вставить("Host","ismotp.crptech.ru");
				///Константин           
				Ответ=HTTPСервисЗапрос.ВызватьHTTPМетод("GET",HTTPЗапрос);
				//Текст1=Ответ.ПолучитьТелоКакСтроку();
				Если Ответ.КодСостояния<>200 Тогда
					СРегистра=ОбщийМодуль_НаСервере_ХамелеонЦРПТ.Получение_Токена(Thumbprint_1,СерийныйНомер);	
				КонецЕсли;
					
		КонецЕсли;
	
		Если не ЗначениеЗаполнено(Срегистра) тогда
			Продолжить;
		Конецесли;

		
		ВыборкаДетальныеЗаписи=ВыборкаДетальныеЗаписи_1.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
			ОбщийМодуль_НаСервере_ХамелеонЦРПТ.ОтправкаВводВОБорот(ВыборкаДетальныеЗаписи.Ссылка,ПользовательДляОтправки)
		Конеццикла;
		
		Попытка
			ОбщийМодуль_НаСервере_ХамелеонЦРПТ.ОбновитьСтатусыДокументовСерверПоПользователю(ПользовательДляОтправки)
		Исключение
		КонецПопытки;
		
	КонецЦикла;
	
	//}}КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА
